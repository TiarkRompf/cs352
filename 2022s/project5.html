<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>CS352 by TiarkRompf</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39122235-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-39122235-1');
    </script>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
    .ttt {font-family: monospace; font-size: 12px; font-style: normal;}
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>CS352</h1>
        <p></p>
        <p class="view"><a href="https://github.com/TiarkRompf/cs352">View the Project on GitHub <small>TiarkRompf/cs352</small></a></p>
        <ul>
          <li><a href="index.html"><strong>Home</strong></a></li>
        </ul>
      </header>
      <section>
<!--content-->

      <div class="title">
        <h1>Project 5: Value Representation</h1>
      </div>

      <blockquote>
        <p>Due 11:59PM Wednesday March 7</p>
      </blockquote>

      <p>Your task in this assignment is to implement a compiler phase for the CPS value representation transformation, including closure conversion. In the skeleton code, you will find a template for this compiler phase in class <span class="ttt">miniscala.CPSValueRepresenter</span>. You can (and are encouraged to) use the helper methods in class <span class="ttt">CPSValueRepresenter</span>, <span class="ttt">CPSTreeModule.Tree</span>, and object <span class="ttt">BitTwiddling</span>. Please note that the the following aspects will be taken into consideration while grading:</p>

<ul>
<li>Correctness of the implementation.
<li>The time and memory efficiency of the implementation.
</ul>

<p>For instance, transforming a primitive operation <i>x op y</i> by naively decoding the arguments <i>(x,y)</i> and encoding the result back will fetch you fewer points if there exists a better translation that avoids, either completely or partially, some encodings/decodings. Note: To that end, make sure to use left shift (<span class="ttt"> << </span>) and right shift (<span class="ttt"> >> </span>) operations to implement multiplication and division by 2 as described in the lectures.</p>

<p>For the closure conversion part, you can choose to implement either the "simple" or the optimized version. Correctly implementing the simplified one will give you 90% of the grade for this assignment, whereas a correct implementation of the optimized transformation will give you 110% of the grade. An optimized version that works without supporting recursive/mutually recursive calls will give you 100% (you can still have function calls if they are not recursive). The extra 10% will be given if recursive and mutually recursive function calls can be handled properly.</p>

<p>Notice, however, that by submitting an incorrect version of the optimized transformation you may lose a lot of points depending on the mistakes. Therefore, we recommend that you start by implementing the basic closure conversion procedure and, if you are successful and still have time, to extend it to the optimized procedure.</p>

<p>NOTE: many functions have an implicit argument <b>worker</b>. This argument should not be useful in the non-optimized version, therefore you are free to pass the value <b>Map.empty</b> to a function call.</p>

<h2>CPS Low Level</h2>

<p>The value representation phase of the MiniScala compiler takes as input a CPS program where all values and primitives are "high-level," in that they have the semantics which the MiniScala language gives them. It produces a "low-level" version of that program as output, in which all values are either integers or pointers and primitives correspond directly to instructions of a typical microprocessor.</p>

<p>This means that the primitive operations used in the CPSLow code (defined in <span class="ttt">CPSPrimitives</span>) are only executing operations on integers (or pointers for block operations). All primitives are performing the operation that you could be expecting based on the name. <s>Note that the CPSByteWrite primitive returns the value 0.</s> <b>Update 10/12/22:</b>: The CPSByteWrite primitive returns the unit value. You can checkout the <span class="ttt">CPSLowInterpreter</span> in the <b>CPSInterpreter.scala</b> file and make sure you understand the CPSLow semantics.</p>

<h2>Testing</h2>
<p>From this assignment on, you will choose the shapes for the trees you generate. You should inspect them visually and decide whether or not they are correct and optimal. The application in the given skeleton code will not have whitebox tests, but it will still have an extensive blackbox test suite to ensure the correctness of the programs you generate.</p>

<p>Although we will not test tree shapes, we still encourage you to do so for every transformation rule you write. You have the necessary infrastructure in <span class="ttt">miniscala.test.CPSValueRepresentation_Whitebox</span> so it's a matter of just writing the source code and the resulting tree. It is usually an effort that pays off.</p>
<p><mark>You should write 10 tests otherwise points will be deducted</mark></p>

<h2>Road Map</h2>

<ul>
	<li> Spend the time to understand the task that has to be accomplished. This means reading the material and the lectures carefully. A good idea to make sure you understand is to manually transform some piece of code. While doing that, write this as a test case! Two birds, one stone.</li>
	<li> Implement the actual value transformation function, keep the closure conversion for last. Test every cases! Of course the best way is to write at least one test case for it, but if you are not willing to write tests then verify that you can generate code that produces a correct result for simple programs. <b>Do not use</b> sbt test everytime you add a case to see if you pass more tests! Many of the Blackbox tests will fail unless the closure conversion has been implemented.</li>
</ul>

<p>Tips:
<ul>
	<li> The implementation can be very technical in some cases, so make sure that you are making good use of the helping function to avoid clustered code!</li>
	<li> When creating fresh variable names, you can try to add some information that will help you to debug. For example, when creating a name for the worker of the function "test" you may prefer to use <span class="ttt">Symbol.fresh("test_worker")</span> rather than <span class="ttt">Symbol.fresh("w")</span>.</li>
</ul>
</p>

<p>The skeleton code for the assignment is available <a href="https://www.cs.purdue.edu/homes/axhebraj/cs352/proj5.zip">here.</a></p>

<p>This assignment relies on the correct implementation of the previous one (the <span class="ttt">CMScalaToCPSTranslator</span> class). If you are confident that your implementation of <span class="ttt">CMScalaToCPSTranslator</span> is correct, feel free to use your implementation. You are also free to use the reference implementation that is part of the skeleton for Project 5.</a>

<h2>Turnin</h2>
<p>You should turn in the <b>proj5</b> directory. Please run an 'sbt clean' and './cleanall.sh' before submitting.</p>

<p>
To turn in your project create a ZIP file named <code>&ltpurdueemailusername&gt-proj&ltN&gt.zip</code>
of the <code>proj5</code> directory
for example <code>axhebraj-proj5.zip</code> and upload it
to the corresponding assignment on Brightspace.
</p>
<p>
<b>
No other file formats or naming conventions will be accepted as submissions.
Verify your submission by downloading the ZIP file you uploaded on Brightspace
and extracting its content. The uncompressed content should be the
<code>proj5</code> folder containing the code.
</b>
</p>

<!--/content-->

      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/TiarkRompf">TiarkRompf</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
